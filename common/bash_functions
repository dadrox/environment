# A bunch of bash functions that I find useful for various purposes
#
# DEPENDS ON ack-grep... you're welcome.  At least on Ubuntu/Mint it is ack-grep.  On OSX homebrew it is just ack

cmds () {
    cat ~/.bash_functions | grep "()" | grep -v "^_" | egrep -v "^[A-Z_]*=" | grep -v "cmds" | grep -v "^\s*#" | sed "s/\s\?()//" | sed 's/ { \# /\t/' | awk '{ printf "%-20s %s\n", $1, substr($0,index($0,$2)) }'
}

cb() { # cd up to a certain directory name
    pushd `pwd | sed -r "s/($1).*/\\1/"`
}
complete -W "$(pwd | tr '/' ' ')" cb

_find_file_w_extension() {
    find . -type f -name $1
}

scala_files() { # find all scala files from the current directory
    _find_file_w_extension "*.scala"
}

groovy_files() { # find all groovy files from the current directory
    _find_file_w_extension "*.groovy"
}

java_files() { # find all java files from the current directory
    _find_file_w_extension "*.java"
}

_grepit() {
    xargs ack-grep --color $1
}

_find_whatev() {
    if [ $3 ]
    then
        $1 | grep -v $3 | _grepit $2
    else
        $1 | _grepit $2
    fi
}

_find_whatev_i() {
    if [ $3 ]
    then
        $1 | grep -v $3 | _grepit -i $2
    else
        $1 | _grepit -i $2
    fi
}

# fs SshClient "Test\|sandbox"
fs() { # finds a given string in scala files. E.g. fs <token to find> [filter word(s)]
	_find_whatev scala_files $1 $2
}

fsi() { # finds a given string in scala files (case-insensitive)
	_find_whatev_i scala_files $1 $2
}

fsc() { # finds a scala class, object, or trait (case-insensitive)
    scala_files | xargs ack-grep -il --color-match=yellow  --match "(class|object|trait) [a-zA-Z]*$1"
}

fa() { # finds a given string in any file
	find . -type f | _grepit $1
}

fai() { # finds a given string in any file (case-insensitive)
    find . -type f | _grepit -i $1
}

fsf() { # finds a scala file with the given string in its name (case-insensitive)
	scala_files | grep -i $1
}

fgr () { # finds a given string in groovy files
	_find_whatev groovy_files $1 $2
}

fgri () { # finds a given string in groovy files (case-insensitive)
	_find_whatev_i groovy_files $1 $2
}

fj() { # finds a given string in java files
	_find_whatev java_files $1 $2
}

fji() { # finds a given string in java files (case-insensitive)
	_find_whatev_i java_files $1 $2
}

fjar() { # find jar in ivy cache (case-insensitive)
	find ~/.ivy2/cache/ -iname "$@.jar"
}

fclass() { # find jar in ivy cache containing a class name with the given string (case-insensitive)
	find ~/.ivy2/cache/ -name "*.jar" -exec grep -il --color "$@" {} \;
}

ff() { # find a file name containing the given string
	find . -type f -iname "*$1*"
}

manifest() { # prints the manifest of the given jar
	unzip -p "$@" META-INF/MANIFEST.MF
}

backup-eclipse() { # zips all .classpath and .project files generated by eclipse
    zip -R eclipse.env.backup-`date +%Y%m%d`.zip .classpath .project
}
